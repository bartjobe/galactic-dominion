<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Galactic Dominion V6</title>

    <!-- React + Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <style>
      html, body {
        margin: 0;
        padding: 0;
        background: radial-gradient(circle at center, #05050a 0%, #000 100%);
        color: #ddd;
        font-family: "Orbitron", sans-serif;
        height: 100%;
        overflow: hidden;
      }

      #root {
        height: 100%;
        width: 100%;
      }

      .title-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        background: radial-gradient(circle at 50% 30%, #0a0a1a, #000);
        text-align: center;
      }

      .game-title {
        font-size: 3rem;
        color: #72d6ff;
        text-shadow: 0 0 10px #00aaff;
        margin-bottom: 1rem;
      }

      .subtitle {
        color: #aaa;
        font-size: 1rem;
        margin-bottom: 2rem;
      }

      input, select, button {
        margin: 0.5rem;
        padding: 0.6rem 1rem;
        background: #111;
        color: #eee;
        border: 1px solid #333;
        border-radius: 8px;
        font-size: 1rem;
      }

      input:focus, select:focus, button:hover {
        border-color: #00aaff;
        outline: none;
      }

      .start-btn {
        background: linear-gradient(90deg, #0066cc, #00aaff);
        color: #fff;
        border: none;
        cursor: pointer;
        font-weight: bold;
        transition: transform 0.2s ease;
      }

      .start-btn:hover {
        transform: scale(1.05);
      }

      .fade-in {
        animation: fadeIn 2s ease forwards;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
      }
    </style>
  </head>

  <body>
    <div id="root"></div>

    <script type="text/babel">

      const races = [
        { id: "human", name: "Humains", desc: "√âquilibr√©s, bons b√¢tisseurs." },
        { id: "cyborg", name: "Cyborgs", desc: "Industrie et efficacit√©." },
        { id: "xeno", name: "Xenos", desc: "Expansion rapide, mais instables." },
        { id: "ai", name: "IA Centrale", desc: "Science et contr√¥le total." },
      ];

      function TitleScreen({ onStart }) {
        const [pseudo, setPseudo] = React.useState(localStorage.getItem("playerPseudo") || "");
        const [race, setRace] = React.useState(localStorage.getItem("playerRace") || "human");

        const handleStart = () => {
          if (!pseudo.trim()) return alert("Entre un pseudo !");
          localStorage.setItem("playerPseudo", pseudo);
          localStorage.setItem("playerRace", race);
          onStart({ pseudo, race });
        };

        return (
          <div className="title-screen fade-in">
            <div className="game-title">üåå Galactic Dominion V6 üåå</div>
            <div className="subtitle">Version prototype - D√©mo locale</div>

            <div>
              <input
                type="text"
                placeholder="Ton pseudo..."
                value={pseudo}
                onChange={(e) => setPseudo(e.target.value)}
              />
            </div>

            <div>
              <select value={race} onChange={(e) => setRace(e.target.value)}>
                {races.map((r) => (
                  <option key={r.id} value={r.id}>
                    {r.name} ‚Äî {r.desc}
                  </option>
                ))}
              </select>
            </div>

            <button className="start-btn" onClick={handleStart}>
              Commencer la conqu√™te
            </button>

            {localStorage.getItem("playerState") && (
              <button
                onClick={() => onStart({
                  pseudo: localStorage.getItem("playerPseudo"),
                  race: localStorage.getItem("playerRace")
                })}
              >
                Continuer
              </button>
            )}
          </div>
        );
      }

      function App() {
        const [started, setStarted] = React.useState(false);

        return (
          <>
            {!started && <TitleScreen onStart={() => setStarted(true)} />}
            {started && <div style={{textAlign:"center",marginTop:"20%",color:"#fff"}}>
              <h2>Chargement de la galaxie...</h2>
              <p>La carte et le moteur du jeu seront ajout√©s ici (Bloc 2).</p>
            </div>}
          </>
        );
      }
      // === Bloc 2 : Moteur de jeu principal ===

      const BASE_BUILDINGS = {
        mine: { name: "Mine", baseProd: 10, baseCost: 100, desc: "Produit des min√©raux." },
        power: { name: "Centrale", baseProd: 8, baseCost: 80, desc: "Produit de l'√©nergie." },
        extractor: { name: "Extracteur", baseProd: 3, baseCost: 120, desc: "Extrait des cristaux rares." },
        lab: { name: "Laboratoire", baseProd: 2, baseCost: 150, desc: "Produit de la science." },
      };

      function GameHUD({ resources, onTick, onUpgrade }) {
        return (
          <div style={{
            position: "absolute", top: 0, left: 0, right: 0,
            background: "rgba(0,0,0,0.6)", display: "flex",
            justifyContent: "space-around", padding: "8px", fontSize: "14px"
          }}>
            {Object.keys(resources).map((r) => (
              <div key={r} title={`Quantit√© de ${r}`}>
                {r.toUpperCase()}: {Math.floor(resources[r])}
              </div>
            ))}
          </div>
        );
      }

      function Tooltip({ text }) {
        return (
          <span style={{
            display: "inline-block",
            background: "#222",
            color: "#fff",
            border: "1px solid #555",
            borderRadius: "6px",
            padding: "4px 6px",
            fontSize: "12px",
            marginLeft: "4px"
          }}>
            {text}
          </span>
        );
      }

      function BuildingPanel({ buildings, onUpgrade, resources }) {
        return (
          <div style={{
            position: "absolute", left: 0, bottom: 0, top: "40px",
            width: "240px", background: "rgba(10,10,15,0.85)",
            overflowY: "auto", padding: "10px"
          }}>
            <h3>üõ†Ô∏è B√¢timents</h3>
            {Object.entries(buildings).map(([key, b]) => {
              const data = BASE_BUILDINGS[key];
              const nextCost = data.baseCost * Math.pow(1.5, b.level);
              const canAfford = resources.mineral >= nextCost;
              return (
                <div key={key} style={{ marginBottom: "10px" }}>
                  <strong>{data.name}</strong> <Tooltip text={data.desc} />
                  <div>Niveau : {b.level}</div>
                  <div>Production : +{Math.round(data.baseProd * b.level)}/tick</div>
                  <button
                    disabled={!canAfford}
                    onClick={() => onUpgrade(key, nextCost)}
                    style={{
                      marginTop: "4px",
                      width: "100%",
                      background: canAfford ? "#0a84ff" : "#444",
                      border: "none",
                      color: "white",
                      borderRadius: "6px",
                      cursor: canAfford ? "pointer" : "not-allowed"
                    }}
                  >
                    Am√©liorer (üíé {Math.round(nextCost)})
                  </button>
                </div>
              );
            })}
          </div>
        );
      }

      function GalaxyMap() {
        const stars = Array.from({ length: 30 }, (_, i) => ({
          x: Math.random() * 100,
          y: Math.random() * 100,
          name: "S-" + (i + 1),
        }));
        return (
          <svg width="100%" height="100%" style={{ background: "black" }}>
            {stars.map((s, i) => (
              <circle
                key={i}
                cx={s.x + "%"}
                cy={s.y + "%"}
                r="2"
                fill="#72d6ff"
                opacity="0.8"
              >
                <title>{s.name}</title>
              </circle>
            ))}
          </svg>
        );
      }

      function GameMain() {
        const [resources, setResources] = React.useState({
          mineral: 500,
          energy: 300,
          crystal: 100,
          science: 0,
        });
        const [buildings, setBuildings] = React.useState({
          mine: { level: 1 },
          power: { level: 1 },
          extractor: { level: 1 },
          lab: { level: 1 },
        });
        const tickTime = 3000;

        React.useEffect(() => {
          const timer = setInterval(() => {
            // Production par tick
            setResources((r) => {
              const gain = {
                mineral: r.mineral + BASE_BUILDINGS.mine.baseProd * buildings.mine.level,
                energy: r.energy + BASE_BUILDINGS.power.baseProd * buildings.power.level,
                crystal: r.crystal + BASE_BUILDINGS.extractor.baseProd * buildings.extractor.level,
                science: r.science + BASE_BUILDINGS.lab.baseProd * buildings.lab.level,
              };
              localStorage.setItem("playerState", JSON.stringify({ resources: gain, buildings }));
              return gain;
            });
          }, tickTime);
          return () => clearInterval(timer);
        }, [buildings]);

        const upgradeBuilding = (key, cost) => {
          setResources((r) => ({ ...r, mineral: r.mineral - cost }));
          setBuildings((b) => ({
            ...b,
            [key]: { level: b[key].level + 1 },
          }));
        };

        return (
          <div style={{ height: "100%", width: "100%", position: "relative" }}>
            <GalaxyMap />
            <GameHUD resources={resources} />
            <BuildingPanel
              buildings={buildings}
              onUpgrade={upgradeBuilding}
              resources={resources}
            />
          </div>
        );
      }

      // === Fin du bloc 2 ===

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
