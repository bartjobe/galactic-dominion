<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>La Galaxie Vivante ‚Äî V6</title>

  <!-- React 17 + Babel -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html,body { height:100%; margin:0; background: radial-gradient(ellipse at bottom, #020419 0%, #00030a 60%, #000 100%); color:#e6f0ff; font-family:Inter, system-ui; overflow:hidden; }
    #root { width:100%; height:100vh; position:relative; }
    .star { transition: transform 0.12s, box-shadow 0.12s; will-change: transform; }
    .star:hover { transform: scale(1.28); z-index:80; }
    .halo { filter: blur(6px) saturate(120%); opacity:0.9; }
    .notif { animation: pop .35s ease-out; }
    @keyframes pop { from { transform: translateY(8px); opacity:0 } to { transform: translateY(0); opacity:1 } }
    .journal::-webkit-scrollbar { width:8px }
    .journal::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius:8px }
    .fade { animation: fadein 1s; }
    @keyframes fadein { from {opacity:0;} to {opacity:1;} }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
  const { useState, useEffect, useRef } = React;

  const rand = (a,b)=>Math.random()*(b-a)+a;
  const randint=(a,b)=>Math.floor(rand(a,b+1));
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const WORLD={SIZE:3400,BASE_COUNT:32};
  const syll=["zor","kan","vel","tor","lin","rax","mer","ion","tal","quor","xen","phi","lun","dra","ora","esh","nar","sol","vak"];
  const randomName=()=>syll[Math.floor(Math.random()*syll.length)]+syll[Math.floor(Math.random()*syll.length)]+"-"+randint(1,999);
  const nextId=(()=>{let i=0;return()=> 'S'+(++i);})();

  // G√©n√©ration des √©toiles
  function generateStar(){
    const lvl=randint(0,3);
    const aligns=['pacifique','conqu√©rant','nomade','scientifique','isolationniste'];
    const align=aligns[randint(0,aligns.length-1)];
    return {
      id: nextId(),
      name: randomName(),
      x: Math.floor(rand(80,WORLD.SIZE-80)),
      y: Math.floor(rand(80,WORLD.SIZE-80)),
      population: Math.floor(rand(10000,2500000)),
      civLevel: lvl,
      alignment: align,
      energy: Math.floor(rand(120,700)),
      status: 'stable',
      owner: null
    };
  }

  function createGalaxy(n=WORLD.BASE_COUNT){
    const arr=[];
    for(let i=0;i<n;i++) arr.push(generateStar());
    return arr;
  }

  // Ressources de base selon la race
  const RACES = {
    "Humain": {minerai:120, energie:120, cristal:50, science:20},
    "Zentari": {minerai:80, energie:200, cristal:100, science:0},
    "Krell": {minerai:200, energie:60, cristal:30, science:10},
    "Sylth": {minerai:100, energie:100, cristal:150, science:50},
  };

  const BASE_BUILDINGS={
    mine:{name:"Mine",cost:50,baseProd:2,resType:"minerai"},
    power:{name:"Centrale",cost:75,baseProd:3,resType:"energie"},
    extractor:{name:"Extracteur",cost:100,baseProd:1,resType:"cristal"},
    lab:{name:"Laboratoire",cost:150,baseProd:0.5,resType:"science"},
  };

  function HUD({resources,player}) {
    return (
      <div className="text-xs text-gray-200 space-y-1">
        <div className="font-bold text-cyan-300">üë®‚ÄçüöÄ {player.name} ({player.race})</div>
        <div>‚õèÔ∏è Minerai : {Math.floor(resources.minerai)}</div>
        <div>‚ö° √ânergie : {Math.floor(resources.energie)}</div>
        <div>üíé Cristal : {Math.floor(resources.cristal)}</div>
        <div>üß™ Science : {Math.floor(resources.science)}</div>
      </div>
    );
  }

  function PlanetPanel({selectedStar,buildings,resources,onBuild}) {
    if(!selectedStar)return null;
    return (
      <div className="mt-2 text-xs text-gray-200 space-y-1 fade">
        <h3 className="text-sm font-bold text-cyan-300">üåç {selectedStar.name}</h3>
        {Object.entries(BASE_BUILDINGS).map(([key,b])=>(
          <button key={key} onClick={()=>onBuild(key,b.cost)} disabled={resources.minerai<b.cost}
            className="block w-full my-1 px-2 py-1 bg-slate-700 rounded disabled:opacity-40 hover:bg-slate-600">
            {b.name} (Co√ªt {b.cost})
          </button>
        ))}
        <div className="mt-2">
          {Object.entries(buildings).map(([k,v])=><div key={k}>{BASE_BUILDINGS[k].name}: {v}</div>)}
        </div>
      </div>
    );
  }

  // √âcran d‚Äôaccueil
  function StartScreen({onStart}) {
    const [name,setName]=useState("");
    const [race,setRace]=useState("Humain");

    return (
      <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-80 fade">
        <div className="bg-slate-800 p-6 rounded-xl w-96 text-center space-y-4">
          <h1 className="text-xl font-bold text-cyan-300">üåå La Galaxie Vivante</h1>
          <p className="text-gray-300 text-sm">Entrez dans un univers dynamique et persistant.</p>
          <input value={name} onChange={e=>setName(e.target.value)} placeholder="Nom du commandant"
            className="w-full p-2 rounded bg-slate-700 text-center" />
          <select value={race} onChange={e=>setRace(e.target.value)} className="w-full p-2 rounded bg-slate-700">
            {Object.keys(RACES).map(r=><option key={r}>{r}</option>)}
          </select>
          <button onClick={()=>name && onStart(name,race)} disabled={!name}
            className="bg-cyan-600 hover:bg-cyan-500 px-4 py-2 rounded w-full font-bold">
            Commencer
          </button>
        </div>
      </div>
    );
  }

  function GalaxyMap({galaxy,onSelect}) {
    return (
      <div className="absolute inset-0">
        {galaxy.map(s=>{
          const size=clamp(6+Math.log10(Math.max(1,s.population))/1.05,6,40);
          const color=s.status==='collapsed'?'#555':'#6ee7b7';
          return (
            <div key={s.id} onClick={()=>onSelect(s)} title={s.name}
              style={{position:'absolute',left:s.x-size/2,top:s.y-size/2,width:size,height:size,borderRadius:999,background:color,cursor:'pointer'}}>
            </div>
          );
        })}
      </div>
    );
  }

  function App(){
    const [player,setPlayer]=useState(null);
    const [galaxy,setGalaxy]=useState([]);
    const [selected,setSelected]=useState(null);
    const [log,setLog]=useState([]);
    const [notif,setNotif]=useState(null);
    const [resources,setResources]=useState(null);
    const [buildings,setBuildings]=useState({mine:0,power:0,extractor:0,lab:0});

    // Chargement de la sauvegarde
    useEffect(()=>{
      const save=localStorage.getItem("galaxieSave");
      if(save){
        const data=JSON.parse(save);
        setPlayer(data.player);
        setResources(data.resources);
        setBuildings(data.buildings);
        setGalaxy(data.galaxy);
        setLog(["Sauvegarde charg√©e."]);
      } else {
        setGalaxy(createGalaxy());
      }
    },[]);

    // Auto-save toutes les 10 secondes
    useEffect(()=>{
      if(!player)return;
      const t=setInterval(()=>{
        localStorage.setItem("galaxieSave",JSON.stringify({player,resources,buildings,galaxy}));
      },10000);
      return()=>clearInterval(t);
    },[player,resources,buildings,galaxy]);

    // Production automatique
    useEffect(()=>{
      if(!resources)return;
      const t=setInterval(()=>{
        setResources(r=>({
          ...r,
          minerai:r.minerai+buildings.mine*BASE_BUILDINGS.mine.baseProd,
          energie:r.energie+buildings.power*BASE_BUILDINGS.power.baseProd,
          cristal:r.cristal+buildings.extractor*BASE_BUILDINGS.extractor.baseProd,
          science:r.science+buildings.lab*BASE_BUILDINGS.lab.baseProd,
        }));
      },3000);
      return()=>clearInterval(t);
    },[buildings,resources]);

    function handleBuild(type,cost){
      if(resources.minerai>=cost){
        setResources(r=>({...r,minerai:r.minerai-cost}));
        setBuildings(b=>({...b,[type]:b[type]+1}));
        setNotif(`${BASE_BUILDINGS[type].name} construit`);
      } else setNotif("Pas assez de minerai !");
    }

    function handleStart(name,race){
      setPlayer({name,race});
      setResources(RACES[race]);
      setGalaxy(createGalaxy());
      setLog([`Bienvenue Commandant ${name} de la race ${race}.`]);
    }

    return (
      <div className="w-full h-full relative select-none">
        {!player && <StartScreen onStart={handleStart} />}

        {player && (
          <>
            <div className="absolute top-3 left-3 text-cyan-300 text-xl font-bold">üåå La Galaxie Vivante ‚Äî V6</div>

            <GalaxyMap galaxy={galaxy} onSelect={setSelected} />

            <div className="absolute bottom-24 right-4 bg-black bg-opacity-60 p-3 rounded w-80">
              <HUD resources={resources} player={player}/>
              {selected && <PlanetPanel selectedStar={selected} buildings={buildings} resources={resources} onBuild={handleBuild}/>}
            </div>

            <div className="absolute bottom-4 left-4 bg-black bg-opacity-60 p-3 rounded w-96 max-h-[46vh] overflow-y-auto journal">
              <div className="font-semibold text-cyan-200 mb-1">Journal Galactique</div>
              {log.map((l,i)=><div key={i} className="text-xs mb-1">‚Ä¢ {l}</div>)}
            </div>

            {notif && <div className="absolute top-16 right-6 notif bg-white bg-opacity-10 p-3 rounded text-sm">{notif}</div>}
          </>
        )}
      </div>
    );
  }

  ReactDOM.render(<App/>,document.getElementById('root'));
  </script>
</body>
</html>
